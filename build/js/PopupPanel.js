define(["dojo/_base/declare","dojo/on","dojo/i18n!esri/nls/jsapi","dojo/dom","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/_base/lang","dojo/_base/window","dijit/registry","dijit/focus","dijit/a11y","esri/domUtils","esri/lang","esri/dijit/Popup"],function(t,o,e,p,i,s,u,n,d,a,l,r,h,c,_,f){return t(null,{declaredClass:"application.PopupPanel",constructor:function(t){var o={popup:null,srcNode:null,toolbar:null};d.mixin(this,o,t)},initPopup:function(){o(this.popup,"selection-change",d.hitch(this,this._displayPopupContent)),o(this.popup,"clear-features",d.hitch(this,this._clearPopupSelection)),o(this.popup,"set-features",d.hitch(this,this._displayPopupContent)),p.byId("popupButtonClose").title=e.widgets.popup.NLS_close,p.byId("popupButtonNext").title=e.widgets.popup.NLS_nextFeature,p.byId("popupButtonPrev").title=e.widgets.popup.NLS_prevFeature,o(n(".popupButton"),"click",d.hitch(this,function(t){"popupButtonClose"===t.target.id?(this._clearPopupSelection(),this._displayPopupWindow(!1)):"popupButtonNext"===t.target.id?this.popup.selectNext():"popupButtonPrev"===t.target.id&&this.popup.selectPrevious()}));var t=e.widgets.popup.NLS_zoomTo||"Zoom to",s=u.create("a",{id:"zoomLink",title:t,href:"javascript: void(0);"},"popupFooter");i.add(s,["action"]),o(s,"click",d.hitch(this,this._zoomToFeature))},_zoomToFeature:function(t){this.popup.getSelectedFeature()&&this.popup._zoomToFeature(t)},_displayPopupContent:function(){var t=this.popup.getSelectedFeature();if(t){this.toolbar&&(this.toolbar.closePage(),o.once(this.toolbar,"updateTool",d.hitch(this,function(t){t&&(this._clearPopupSelection(),this._displayPopupWindow(!1))}))),this._displayPopupWindow(!0);var i=l.byId(this.srcNode);i&&i.set("content",t.getContent());var s=e.widgets.popup.NLS_pagingInfo,u=this.popup.features?this.popup.features.length:0,n="";u>1&&(n=_.substitute({index:this.popup.selectedIndex+1,total:u},s)),this._updatePagingControls(),p.byId("popupTitle").innerHTML=n}else this._displayPopupWindow(!1)},_updatePagingControls:function(){var t=n(".popupButton.prev")[0],o=n(".popupButton.next")[0],e=this.popup.selectedIndex,p=this.popup.features?this.popup.features.length:0;p>1?(0===e?i.add(t,"hidden"):i.remove(t,"hidden"),e===p-1?i.add(o,"hidden"):i.remove(o,"hidden")):(i.add(o,"hidden"),i.add(t,"hidden"))},_displayPopupWindow:function(t){n(".panelPopup").forEach(function(o){if(t)c.show(o);else{c.hide(o);var e=p.byId("search_input");e&&r.focus(e)}})},_clearPopupSelection:function(){this.popup.getSelectedFeature()&&this.popup.clearFeatures()}})});